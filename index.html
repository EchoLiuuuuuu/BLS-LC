<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>BLS Data for Lightcast</title>
  <!-- Import the React, React-Dom and Babel libraries from unpkg -->
  <script type="application/javascript" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script type="application/javascript" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script type="application/javascript" src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
  <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
  <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
</head>

<body>
  <div id="root"></div>

  <style type="text/css">
    @font-face {
      font-family: "Lausanne";
      src: url("./TWKLausanne-400.ttf") format("truetype");
    }

    @font-face {
      font-family: "EverettMono";
      src: url("./TWKEverettMono-Regular-web.ttf") format("truetype");
    }

    h2,
    h1,
    h3,
    h4 {
      font-family: "Lausanne", Verdana, Tahoma;
    }

    ticklabel {
      font-family: "EverettMono";
    }

    /* html * {
      font-family: "Lausanne";
    } */
  </style>

  <script type="text/babel">
    // Obtain the root 
    const rootElement = document.getElementById('root')
    const colors = ["#FF2F59", "#CA61FF", "#18E8F5", "#0A5D62", "#8A8A8A", "#2E5299", "#93293B"]
    // Create a ES6 class component    
    class ImageChart extends React.Component {
      // Use the render function to return JSX component      
      render() {
        return (
          <div style={{ marginRight: "auto", marginLeft: "auto", marginBottom: "100px", width: "50vw", top: "50%", left: "50%" }} className="ImageChart">
            <p>{this.props.title}</p>
            <img style={{ top: "50%", left: "50%", margin: "auto", width: "50vw" }} src={this.props.imgurl} />
          </div>
        );
      }
    }

    class InteractiveChart extends React.Component {

      // data = fetch(this.props.dataurl).json();
      constructor(props) {
        super(props)
        this.state = {
          data: []
        }
      }

      componentDidMount = () => {

        // const loadedData = getData(this.props.dataurl)
        let self = this;
        // console.log(this.props)
        fetch(this.props.dataurl,
          {
            method: 'GET',
            mode: 'cors',
          })
          .then(
            response => {
              if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' +
                  response.status);
                console.log(response);
                return;
              }
              // Examine the text in the response
              response.json().then(function (data) {
                console.log("Got data!")
                // console.log(data);
                self.setState({
                  data: data
                });
                return;
              });

            })
          .catch(err => console.log('Fetch Error :-S', err));
        console.log(this.state.data);
      }

      render() {

        // const data = getData(this.props.dataurl);
        // console.log(this.state.data);
        if (typeof (this.state.data) == []) {
          return <div />
        }

        if (this.props.chart_type == "line") {
          return (
            <div style={{ margin: "0 auto", width: "75vw", height: "500px", marginBottom: "150px" }}>
              <h2 style={{ marginTop: "30px", marginBottom: "3px" }}>{this.props.title}</h2>
              <h4 style={{ marginTop: "2px", marginBottom: "10px" }}>{this.props.subtitle}</h4>
              <ResponsiveContainer width="100%" height="100%">
                <LineChart label="hi" style={{ marginRight: "auto", marginLeft: "auto", marginBottom: "5px", marginTop: "10px", width: "100%" }}
                  width={750} height={400} data={this.state.data}
                  margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
                  <XAxis dataKey={this.props.axis} style={{
                    fontSize: '0.8rem',
                    fontFamily: 'Lausanne',
                  }} />
                  <YAxis style={{
                    fontSize: '0.7rem',
                    fontFamily: 'EverettMono',
                  }} tickFormatter={this.props.series_format} tickCount={8} />
                  <CartesianGrid vertical={false} />
                  <Tooltip formatter={(value, name, props) => this.props.series_format(value)}
                    labelStyle={{ fontFamily: "Lausanne" }}
                    itemStyle={{ fontFamily: "Lausanne" }}
                    contentStyle={{
                      borderRadius: 10, borderColor: "#FFDFE6", boxShadow:
                        "0 1px 1px rgba(0,0,0,0.11), 0 2px 2px rgba(0, 0, 0, 0.11),0 4px 4px rgba(0,0,0,0.11),0 8px 8px rgba(0,0,0,0.11),0 16px 16px rgba(0,0,0,0.11),0 32px 32px rgba(0,0,0,0.11)"
                    }} />
                  <Legend formatter={(value, name, props) => <span style={{ fontFamily: "Lausanne" }}>{value}</span>} />

                  {
                    this.props.series_indices.map((id) => {
                      return (<Line type="monotone" dot={false} name={this.props.series_names[id]} dataKey={this.props.series_ids[id]} stroke={colors[id]} />)
                    })
                  }

                </LineChart>
              </ResponsiveContainer >
              <div>
                <h4 style={{ marginTop: "2px", display: "inline-block", float: "left" }}>Source: Bureau of Labor Statistics</h4>
                <img src="Lightcast Tessell.PNG" style={{ width: 96, height: 22, display: "inline-block", float: "right" }} />
              </div>
            </div>
          );
        }

        if (this.props.chart_type == "bar") {
          return (
            <div style={{ margin: "0 auto", width: "75vw", height: "500px", marginBottom: "150px" }}>
              <h2 style={{ marginTop: "30px", marginBottom: "3px" }}>{this.props.title}</h2>
              <h4 style={{ marginTop: "2px" }}>{this.props.subtitle}</h4>
              <ResponsiveContainer width="100%" height="100%">
                <BarChart
                  width={750}
                  height={400}
                  data={this.state.data}
                  margin={{
                    top: 5,
                    right: 30,
                    left: 20,
                    bottom: 5,
                  }}
                >
                  <CartesianGrid vertical={false} />
                  <XAxis dataKey={this.props.axis} style={{
                    fontSize: '0.8rem',
                    fontFamily: 'Lausanne',
                  }} />
                  <YAxis style={{
                    fontSize: '0.7rem',
                    fontFamily: 'EverettMono',
                  }} tickFormatter={this.props.series_format} tickCount={8} />
                  <Tooltip formatter={(value, name, props) => this.props.series_format(value)}
                    labelStyle={{ fontFamily: "Lausanne" }}
                    itemStyle={{ fontFamily: "Lausanne" }}
                    contentStyle={{
                      borderRadius: 10, borderColor: "#FFDFE6", boxShadow:
                        "0 1px 1px rgba(0,0,0,0.11), 0 2px 2px rgba(0, 0, 0, 0.11),0 4px 4px rgba(0,0,0,0.11),0 8px 8px rgba(0,0,0,0.11),0 16px 16px rgba(0,0,0,0.11),0 32px 32px rgba(0,0,0,0.11)"
                    }} />

                  <Legend formatter={(value, name, props) => <span style={{ fontFamily: "Lausanne" }}>{value}</span>} />
                  {
                    this.props.series_indices.map((id) => {
                      return (<Bar name={this.props.series_names[id]} dataKey={this.props.series_ids[id]} fill={colors[id]} />)
                    })
                  }
                </BarChart>
              </ResponsiveContainer>
              <div>
                <h4 style={{ marginTop: "2px", display: "inline-block", float: "left" }}>Source: Bureau of Labor Statistics</h4>
                <img src="Lightcast Tessell.PNG" style={{ width: 96, height: 22, display: "inline-block", float: "right" }} />
              </div>
            </div>
          );
        }

      }
    }

    const SimpleList = ({ list }) => (
      <ul>

        {list.map(item => (
          <ImageChart title="" imgurl={item} />
        ))}
      </ul>
    );

    const InteractiveList = ({ list }) => (
      <ul>
        {list.map(item => (
          <InteractiveChart title={item.title}
            dataurl={item.link}
            subtitle={item.subtitle}
            series_indices={item.series_indices}
            chart_type={item.chart_type}
            axis={item.axis}
            series_ids={item.series_ids}
            series_names={item.series_names}
            series_format={item.series_format}
          />
        ))}
      </ul>
    );

    const urls = ["https://bls-jolts.s3.amazonaws.com/Unemployed+to+Openings+Ratio.png",
      "https://bls-jolts.s3.amazonaws.com/Total+quits+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+separations+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+quits+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+layoffs+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+job+openings+(Major).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+job+openings+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+job+openings+(Breakdown).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+hires+(Current+month+only).png",
      // "https://bls-jolts.s3.amazonaws.com/Separations+by+Type.png",
      "https://bls-jolts.s3.amazonaws.com/Separations+by+Type+(numbers).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+separations+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+quits+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+layoffs+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+job+openings+(Major).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+job+openings+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+job+openings+(Breakdown).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+hires+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Monthly+job+openings.png",
      "https://bls-jolts.s3.amazonaws.com/Layoffs+and+Quits+With+Data+Labels+(2018-Now).png",
      "https://bls-jolts.s3.amazonaws.com/Hires+and+Separations.png"];

    // const interactiveURLS = [{
    //   "link": "https://bls-jolts.s3.amazonaws.com/json_jolts_ts.json",
    //   "title": "Monthly job openings",
    //   "subtitle": "In millions and seasonally adjusted",
    //   "num_series": 1,
    //   "chart_type": "line",
    //   "series_ids":["value"],
    //   "series_names" :["Openings"]
    // }]
    const percentFormat = (tick) => {
      return `${tick.toFixed(2)}%`;
    }
    const defaultFormat = (tick) => {
      return tick;
    }

    console.log("Running!")

    var interactiveURLS = [{
      "link": "https://bls-cpi.s3.amazonaws.com/json_all_change.json",
      "title": "CPI for all urban customers",
      "subtitle": "All items in US city everage",
      "chart_type": "line",
      "axis": "month_year",
      "series_indices": [0, 1],
      "series_ids": ["cpi_yoy_change", "change_mom_cpi"],
      "series_names": ["YoY CPI Change", "MoM CPI Change"],
      "series_format": percentFormat
    },
    {
      "link": "https://bls-cpi.s3.amazonaws.com/json_all_core_change.json",
      "title": "CPI for all urban customers",
      "subtitle": "All items in US city everage",
      "chart_type": "line",
      "axis": "month_year",
      "series_indices": [0, 1],
      "series_ids": ["change_mom_cpi_all", "change_mom_cpi_core"],
      "series_names": ["All items", "All items less food and energy"],
      "series_format": percentFormat
    },
    {
      "link": "https://bls-cpi.s3.amazonaws.com/json_final_yoy_all_items_change_2.json",
      "title": "CPI for all urban customers",
      "subtitle": "Percent change from 12 months ago, unadjusted",
      "chart_type": "bar",
      "axis": "series_name",
      "series_indices": [0, 1, 2],
      "series_ids": ["Apr 2023", "Mar 2adad023", "May 2023"],
      // putting random data in the names to verify that it gets them from the server instead
      "series_names": ["Apriadadl 2023", "Madadadr 2023", "May 2023"],
      "series_format": percentFormat
    },
    {
      "link": "https://bls-cpi.s3.amazonaws.com/json_Comp_cpi_yoy.json",
      "title": "YOY Change for Hourly Earnings and CPI",
      "subtitle": "In percentage and unadjusted",
      "chart_type": "line",
      "axis": "month_year",
      "series_indices": [0, 1],
      "series_ids": ["increase", "cpi_yoy_change"],
      "series_names": ["Increase in Hourly Earnings", "CPI (all items)"],
      "series_format": percentFormat
    }, {
      "link": "https://bls-cpi.s3.amazonaws.com/json_final_yoy_cat_items_change.json",
      "title": "CPI for all urban customers",
      "subtitle": "Percent change from 12 months ago, unadjusted",
      "chart_type": "bar",
      "axis": "series_title",
      "series_indices": [0, 1, 2],
      "series_ids": ["Madar dada2023", "Apr 2023a", "May 2adad023"],
      "series_names": ["Mar adad2023", "Apriadadal 2023a", "May 202dada3"],
      "series_format": percentFormat
    }]

    let dataGlobal;

    const getData = async () => {
      const response = await fetch("https://bls-cpi.s3.amazonaws.com/json_datedata_df.json");
      const data = await response.json();
      dataGlobal = data;
      return data;
    };



    const { PieChart,
      Pie, Line, LineChart, linearGradient, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,
      Bar, BarChart } = window.Recharts

    function App() {

      const [state, setState] = React.useState({
        urls: [],
        gotData: false
      });
      let self = setState;
      
      React.useEffect(() => {

  
          getData().then( (output) => {
          console.log(output)
          // console.log(interactiveURLS[interactiveURLS.length-1].series_ids = dataGlobal/)
          const currMoList = [output[2].month_year, output[1].month_year, output[0].month_year]
          const currMoIDList = [output[2].month_year_s, output[1].month_year_s, output[0].month_year_s]
          console.log(currMoList)
          // manually updating the two series that require dates
          // there's probably a better way to do this
          interactiveURLS[interactiveURLS.length - 1].series_names = currMoList
          interactiveURLS[interactiveURLS.length - 1].series_ids = currMoIDList

          interactiveURLS[2].series_names = currMoList
          interactiveURLS[2].series_ids = currMoIDList
          
          console.log(interactiveURLS)
          self({urls : interactiveURLS, gotData:true})
          }
          );
        
      },[])

      if (!state.gotData) {
        return (
          <div>
            <h1 style={{ margin: "auto", textAlign: "center", padding: "20px" }}>CPI Data</h1>
            <h2 style={{ margin: "auto", textAlign: "center" }}>This webpage contains up-to-date Lightcast-branded charts on BLS CPI data</h2>
            <h3 style={{ margin: "auto", textAlign: "center", padding: "20px" }}>Loading time information...</h3>
          </div>
        )
      }
      return (
        <div>
          <h1 style={{ margin: "auto", textAlign: "center", padding: "20px" }}>CPI Data</h1>
          <h2 style={{ margin: "auto", textAlign: "center" }}>This webpage contains up-to-date Lightcast-branded charts on BLS CPI data</h2>
          <InteractiveList list={state.urls} />
        </div>
      )
    }


    // Use the ReactDOM.render to show your component on the browser
    ReactDOM.render(
      <App />,
      rootElement
    )
  </script>

</body>

</html>
