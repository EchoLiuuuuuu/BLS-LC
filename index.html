<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>React Local</title>
  <!-- Import the React, React-Dom and Babel libraries from unpkg -->
  <script type="application/javascript" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script type="application/javascript" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script type="application/javascript" src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
  <!-- <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.3.0/chart.umd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-chartjs-2/2.1.0/react-chartjs-2.min.js"></script> -->
  <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
  <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
</head>

<body>
  <div id="root"></div>

  <style type="text/css">
    @font-face {
      font-family: "Lausanne";
      src: url("./TWKLausanne-400.ttf") format("truetype");
    }

    h2,
    h1,
    h3,
    h4 {
      font-family: "Lausanne", Verdana, Tahoma;
    }
  </style>

  <script type="text/babel">
    // Obtain the root 
    const rootElement = document.getElementById('root')
    // Create a ES6 class component    
    class ImageChart extends React.Component {
      // Use the render function to return JSX component      
      render() {
        return (
          <div style={{ marginRight: "auto", marginLeft: "auto", marginBottom: "100px", width: "50vw", top: "50%", left: "50%" }} className="ImageChart">
            <p>{this.props.title}</p>
            <img style={{ top: "50%", left: "50%", margin: "auto", width: "50vw" }} src={this.props.imgurl} />
          </div>
        );
      }
    }

    async function getData(url) {

      return await fetch(url,
        {
          method: 'GET',
          mode: 'cors',
        })
        .then(
          response => {
            if (response.status !== 200) {
              console.log('Looks like there was a problem. Status Code: ' +
                response.status);
              console.log(response);
              return;
            }
            // Examine the text in the response
            response.json().then(function (data) {
              console.log("Got data!")
              // console.log(data);
              return data;
            });

          })
        .catch(err => console.log('Fetch Error :-S', err));
    }

    class InteractiveChart extends React.Component {

      // data = fetch(this.props.dataurl).json();
      constructor(props) {
        super(props)
        this.state = {
          data: []
        }
      }

      componentDidMount = () => {

        // const loadedData = getData(this.props.dataurl)
        let self = this;
        fetch(this.props.dataurl,
          {
            method: 'GET',
            mode: 'cors',
          })
          .then(
            response => {
              if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' +
                  response.status);
                console.log(response);
                return;
              }
              // Examine the text in the response
              response.json().then(function (data) {
                console.log("Got data!")
                console.log(data);
                self.setState({
                  data: data
                });
                return;
              });

            })
          .catch(err => console.log('Fetch Error :-S', err));
        console.log(this.state.data);
        // this.setState({
        //   data: loadedData
        // });
      }

      render() {

        // const data = getData(this.props.dataurl);
        console.log(this.state.data);
        if (typeof (this.state.data) == 'undefined') {
          return <div />
        }
        var series_name = "None"
        // console.log("created chart!")
        if (typeof (this.state.data[0]) == 'undefined') {
          console.log("no data yet")
        } else {
          console.log(this.state.data[0].series_name)
          series_name = this.state.data[0].series_name
        }
        return (
          <div style={{ margin: "0 auto", width: "50vw" }}>
            <h2 style={{ marginTop: "30px", marginBottom: "3px" }}>{this.props.title}</h2>
            <h4 style={{ marginTop: "2px" }}>{this.props.subtitle}</h4>
            
            <LineChart label="hi" style={{ marginRight: "auto", marginLeft: "auto", marginBottom: "5px", marginTop: "10px", width: "100%" }} width={730} height={250} data={this.state.data}
              margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
              <XAxis dataKey="month_year" />
              <YAxis />
              <CartesianGrid strokeDasharray="3 3" />
              <Tooltip />
              <Legend />
              <Line type="monotone" name={series_name} dataKey="value" stroke="#FF2F59" />

            </LineChart>
            <h4 style={{ marginTop: "2px" }}>Source: Bureau of Labor Statistics</h4>

          </div>
        );
      }
    }

    const SimpleList = ({ list }) => (
      <ul>

        {list.map(item => (
          <ImageChart title="" imgurl={item} />
        ))}
      </ul>
    );

    const InteractiveList = ({ list }) => (
      <ul>
        {list.map(item => (
          <InteractiveChart title={item.title} dataurl={item.link} subtitle={item.subtitle} />
        ))}
      </ul>
    );

    const urls = ["https://bls-jolts.s3.amazonaws.com/Unemployed+to+Openings+Ratio.png",
      "https://bls-jolts.s3.amazonaws.com/Total+quits+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+separations+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+quits+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+layoffs+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+job+openings+(Major).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+job+openings+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+job+openings+(Breakdown).png",
      "https://bls-jolts.s3.amazonaws.com/Total+monthly+change+in+hires+(Current+month+only).png",
      // "https://bls-jolts.s3.amazonaws.com/Separations+by+Type.png",
      "https://bls-jolts.s3.amazonaws.com/Separations+by+Type+(numbers).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+separations+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+quits+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+layoffs+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+job+openings+(Major).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+job+openings+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+job+openings+(Breakdown).png",
      "https://bls-jolts.s3.amazonaws.com/PCT+monthly+change+in+hires+(Current+month+only).png",
      "https://bls-jolts.s3.amazonaws.com/Monthly+job+openings.png",
      "https://bls-jolts.s3.amazonaws.com/Layoffs+and+Quits+With+Data+Labels+(2018-Now).png",
      "https://bls-jolts.s3.amazonaws.com/Hires+and+Separations.png"];

    const interactiveURLS = [{
      "link": "https://bls-jolts.s3.amazonaws.com/json_jolts_ts.json",
      "title": "Monthly job openings",
      "subtitle": "In millions and seasonally adjusted",
      "num_series" : 1,
      "chart_type" : "line"

    }]
    const dateUrl = ["insert date url here"];
    // Create a function to wrap up your component
    // const { useState } = React;

    console.log(window.Recharts);


    const { PieChart,
      Pie, Line, LineChart, linearGradient, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts


    function App() {

      return (
        <div>
          <h1 style={{ margin: "auto", textAlign: "center", padding: "20px" }}>JOLTS Data</h1>
          <h2 style={{ margin: "auto", textAlign: "center" }}>This webpage will contain up-to-date Lightcast-branded charts on JOLTS data!</h2>
          <InteractiveList list={interactiveURLS} />
        </div>
      )
    }


    // Use the ReactDOM.render to show your component on the browser
    ReactDOM.render(
      <App />,
      rootElement
    )
  </script>

</body>

</html>
